name: Test the outdated action
run-name: ${{ github.actor }} Running action_npm_outdated test.
on: [push, workflow_dispatch] 
jobs:
  test-action:
    runs-on: ubuntu-latest
    env:
      DOCKER_BUILDKIT: 1
      BUILDKIT_PROGRESS: plain

    steps:
    - name: Check out repository code
      uses: actions/checkout@v4

    # Setup .npmrc file to publish to GitHub Packages
    - uses: actions/setup-node@v4
      with:
        node-version: 20.15.1
        registry-url: 'https://npm.pkg.github.com'
        # Defaults to the user or organization that owns the workflow file
        scope: '@tjsr'

    - uses: ./
      id: outdated
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        setup-npm: true
        dependency: 'rimraf'
        project: 'action-npm-outdated'
        skipNpmCiExecute: false
    
    - name: Output the updated version
      env:
        OUTPUT: ${{ fromJson(steps.outdated.outputs) }}
      run: |
        echo "Output data: $OUTPUT"
        echo "The updated version is ${{ steps.outdated.outputs.latestVersion }}"
